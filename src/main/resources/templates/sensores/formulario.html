<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${titulo}">Crear Sensor</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="/app/dashboard">
                <i class="bi bi-cpu"></i> IoT Dashboard
            </a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="/app/dashboard">Dashboard</a>
                <a class="nav-link active" href="/sensores">Sensores</a>
                <div sec:authorize="isAuthenticated()">
                    <form class="d-inline" method="post" action="/logout">
                        <button type="submit" class="btn btn-outline-light btn-sm">
                            <i class="bi bi-box-arrow-right"></i> Salir
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </nav>

    <div class="container my-4">
        <!-- Breadcrumb -->
        <nav aria-label="breadcrumb" class="mb-4">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="/app/dashboard">Dashboard</a></li>
                <li class="breadcrumb-item"><a href="/sensores">Sensores</a></li>
                <li class="breadcrumb-item active" th:text="${accion == 'crear'} ? 'Nuevo' : 'Editar'">Nuevo</li>
            </ol>
        </nav>

        <!-- Header -->
        <div class="row mb-4">
            <div class="col">
                <h1 class="h2" th:text="${titulo}">Crear Nuevo Sensor</h1>
                <p class="text-muted">Complete los datos para registrar un nuevo sensor IoT</p>
            </div>
        </div>

        <!-- Formulario -->
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="bi bi-plus-circle"></i>
                            <span th:text="${accion == 'crear'} ? 'Datos del Nuevo Sensor' : 'Editar Sensor'">Datos del Nuevo Sensor</span>
                        </h5>
                    </div>
                    <div class="card-body">
                        <form th:action="${accion == 'crear'} ? '/sensores/crear' : '/sensores/' + ${sensor?.id} + '/actualizar'" 
                              method="post" novalidate>
                            
                            <!-- Información Básica -->
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label for="nombre" class="form-label">Nombre del Sensor <span class="text-danger">*</span></label>
                                    <input type="text" 
                                           class="form-control" 
                                           id="nombre" 
                                           name="nombre" 
                                           th:value="${sensor?.nombre}"
                                           placeholder="Ej: Sensor Temperatura Central"
                                           required>
                                    <div class="invalid-feedback">
                                        El nombre del sensor es obligatorio
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <label for="tipo" class="form-label">Tipo de Sensor <span class="text-danger">*</span></label>
                                    <select class="form-select" id="tipo" name="tipo" required>
                                        <option value="" disabled th:selected="${sensor?.tipo == null}">Seleccione un tipo</option>
                                        <option value="temperatura-humedad" th:selected="${sensor?.tipo == 'temperatura-humedad'}">Temperatura-Humedad</option>
                                    </select>
                                    <div class="invalid-feedback">
                                        Debe seleccionar un tipo de sensor
                                    </div>
                                </div>
                            </div>

                            <!-- Ubicación -->
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label for="ciudad" class="form-label">Ciudad <span class="text-danger">*</span></label>
                                    <input type="text" 
                                           class="form-control" 
                                           id="ciudad" 
                                           name="ciudad" 
                                           th:value="${sensor?.ciudad}"
                                           placeholder="Ej: Buenos Aires"
                                           required>
                                    <div class="invalid-feedback">
                                        La ciudad es obligatoria
                                    </div>
                                </div>
                            </div>

                            <!-- Coordenadas -->
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label for="latitud" class="form-label">Latitud</label>
                                    <input type="number" 
                                           class="form-control" 
                                           id="latitud" 
                                           name="latitud" 
                                           step="0.000001"
                                           th:value="${sensor?.latitud}"
                                           placeholder="Ej: -34.603722">
                                    <div class="form-text">Coordenada geográfica (opcional)</div>
                                </div>
                                <div class="col-md-6">
                                    <label for="longitud" class="form-label">Longitud</label>
                                    <input type="number" 
                                           class="form-control" 
                                           id="longitud" 
                                           name="longitud" 
                                           step="0.000001"
                                           th:value="${sensor?.longitud}"
                                           placeholder="Ej: -58.381592">
                                    <div class="form-text">Coordenada geográfica (opcional)</div>
                                </div>
                            </div>

                            <!-- Configuración -->
                            <div class="row mb-3">
                                <div class="col-md-12">
                                    <label for="estado" class="form-label">Estado</label>
                                    <select class="form-select" id="estado" name="estado">
                                        <option value="activo" th:selected="${sensor?.estado == 'activo' or sensor?.estado == null}">Activo</option>
                                        <option value="inactivo" th:selected="${sensor?.estado == 'inactivo'}">Inactivo</option>
                                        <option value="falla" th:selected="${sensor?.estado == 'falla'}">Falla</option>
                                    </select>
                                </div>
                            </div>

                            <!-- País -->
                            <div class="mb-4">
                                <label for="pais" class="form-label">País</label>
                                <input type="text" 
                                       class="form-control" 
                                       id="pais" 
                                       name="pais" 
                                       th:value="${sensor?.pais ?: 'Argentina'}"
                                       placeholder="Argentina">
                            </div>

                            <!-- Botones -->
                            <div class="d-flex justify-content-between">
                                <a href="/sensores" class="btn btn-secondary">
                                    <i class="bi bi-arrow-left"></i> Cancelar
                                </a>
                                <button type="submit" class="btn btn-primary">
                                    <i class="bi bi-check-circle"></i>
                                    <span th:text="${accion == 'crear'} ? 'Crear Sensor' : 'Actualizar Sensor'">Crear Sensor</span>
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Validación del formulario
        (function() {
            'use strict';
            window.addEventListener('load', function() {
                var forms = document.getElementsByTagName('form');
                var validation = Array.prototype.filter.call(forms, function(form) {
                    form.addEventListener('submit', function(event) {
                        if (form.checkValidity() === false) {
                            event.preventDefault();
                            event.stopPropagation();
                        }
                        form.classList.add('was-validated');
                    }, false);
                });
            }, false);
        })();
    </script>
</body>
</html>
